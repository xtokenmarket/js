import { Abi } from '@xtoken/abis'
import { formatEther, Interface } from 'ethers/lib/utils'
import { formatNumber } from '../../utils'
import { toTitleCase } from '../utils'
import { getXtkStakingContract } from './helper'
const fromBlock = 12838146
export const getXtkHistory = async (type, account, provider) => {
  const label = toTitleCase(type)
  const stakingContract = await getXtkStakingContract(provider)
  const filter = stakingContract.filters[type](account, null, null)
  const logs = await stakingContract.queryFilter(filter, fromBlock)
  const iface = new Interface(Abi.XTKManagementStakingModule)
  const promises = logs.map(async (log) => {
    const block = await provider.getBlock(log.blockNumber)
    const parsedLog = iface.parseLog(log)
    const { xtkAmount } = parsedLog.args
    return {
      time: block.timestamp,
      label,
      value: `${formatNumber(formatEther(xtkAmount), 2).toFixed(2)}`,
      txHash: log.transactionHash,
    }
  })
  return Promise.all(promises)
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9ibG9ja2NoYWluL3N0YWtpbmcvaGlzdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQ2xDLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFHekQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUMxQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBRXRDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUVoRCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUE7QUFFMUIsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLEtBQUssRUFDaEMsSUFBa0IsRUFDbEIsT0FBZSxFQUNmLFFBQXNCLEVBQ2EsRUFBRTtJQUNyQyxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDL0IsTUFBTSxlQUFlLEdBQUcsTUFBTSxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUU3RCxNQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDakUsTUFBTSxJQUFJLEdBQW1CLE1BQU0sZUFBZSxDQUFDLFdBQVcsQ0FDNUQsTUFBTSxFQUNOLFNBQVMsQ0FDVixDQUFBO0lBQ0QsTUFBTSxLQUFLLEdBQUcsSUFBSSxTQUFTLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUE7SUFFM0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDdEMsTUFBTSxLQUFLLEdBQVUsTUFBTSxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUM3RCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ3JDLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFBO1FBRXBDLE9BQU87WUFDTCxJQUFJLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDckIsS0FBSztZQUNMLEtBQUssRUFBRSxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzlELE1BQU0sRUFBRSxHQUFHLENBQUMsZUFBZTtTQUM1QixDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7SUFFRixPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUE7QUFDOUIsQ0FBQyxDQUFBIn0=
